# opnrnv-r-145
ruleId: aws-management-tools-cloudtrail-s3-dataevents-enabled
type: asset
ruleName: >
  Checks whether at least one AWS CloudTrail trail is logging Amazon S3 data events for all S3 buckets.
description: >
  The rule is NON_COMPLIANT if trails log data events for S3 buckets is not configured.
severity: high
enabled: true
sql: >
  SELECT 'No AWS CloudTrail trails that track all data events for S3' AS arn
  WHERE NOT EXISTS
  (SELECT * from awscloudtrailtrail
  WHERE '["arn:aws:s3"]' = (SELECT CAST(jsonb_array_elements(jsonb_array_elements(supplementaryconfiguration->'eventSelectors'->'eventSelectors')->'dataResources')->>'values' AS TEXT)));
remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
